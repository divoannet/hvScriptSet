#hvScriptSet

Скрипт предназначен для форумов на сервисах Mybb и QuadroBoards.

Скрипт добавляет возможность заменить ник, статус, аватар, подпись и личные поля пользователя в рамках одного сообщения (надеть "маску" на профиль).

Скрипт добавляет форму предпросмотра маски, а также сохраняет последние шесть использованных масок, чтобы после их можно было быстро вставить в пост, не перезаполняя форму.

По умолчанию скрипт позволяет изменять ник, статус, аватар и подпись, но есть возможность расширить действие на дополнительные поля профиля.

Существует *полная* и *усечённая* версия маски. Усечённая позволяет менять в рамках поста только аватар.

Есть возможноть настроить скрипт так, чтобы в рамках одного форума разные группы пользователей имели разные права доступа к маске.

Гостям скрипт не виден, он не работает даже при ручном вводе тегов маски в сообщение. Исключение - форумы-архивы, где могут встречаться сообщения удалённых пользователей. Исключения определяются администратором в настройках.

## Поддержка

Скрипт поддерживается пользователем **Человек-Шаман** на Едином форуме техподдержки mybb (http://forum.mybb.ru/) или через почту homoveneficus@gmail.com

## Установка

Для установки скрипта на свой форум необходим
1. Файл скрипта
2. Скрипт с настройками

Настройки необходимы, чтобы скрипт адаптировался именно под ваш форум, правильно определял допуск пользователя и не позволял ничего лишнего.

Выглядит это так:

```
<script src="http://f.etrin.ru/hvss/hvss.min.js"></script>
<script>
hvScriptSet.addMask({
  /* здесь ваши настройки */
});
</script>
```

Генератор основных настроек находится тут: http://f.etrin.ru/hvss/

## Использование

После установки скрипта на сайт над формой ответа появится новая кнопка.

![Форма ответа](http://i.imgur.com/f9S7SHD.png)

По нажатию на неё при наличии у пользователя расширенных прав появляется окно маски:

![Форма маски](http://i.imgur.com/f9S7SHD.png)

При заполнении формы маска автоматически отображается слева в виде превью. После по кнопке "Вставить маску" необходимые теги сами проставляются в форму сообщения, а маска сохраняется в списке справа для возможности повторного использования.
Маски сохраняются на форуме отдельно для каждого профиля и доступны с любого устройства.

Если на форуме установлены *усечённые* права на доступ, диалог маски не появляется. В форму ответа вставляется тег `[icon][/icon]`. В этом режиме маски не сохраняются.
Такого же эффекта можно добиться и при установке *полных* прав: достаточно нажать на иконку маски с зажатой клавишей Ctrl.

## Стилизация

* **Хочу поставить другой фон для диалога маски.**

Стили диалога маски можно прописывать в настройках стиля форума: «Администрирование > Свой стиль».
Например, для задания заднего фона окошку нужно прописать в "своём стиле" в любом из полей:

```css
#mask_dialog .inner {
    background: url('ваша картинка фона');
}
```

* **Игрок поставил большую картинку как аватар, и профиль разнесло =(**

Чтобы такого не случалось, пропишите в «Администрирование > Свой стиль» в конце любого из полей следующее:

```css
.pa-avatar img {
    max-width: 180px;
    max-height: 180px;
}
```

180px можно заменить на свои значения, в пикселах, за границы которых не позволено выходить аватарам.

## Часто встречающиеся проблемы

* **А если у меня уже установлен другой скрипт смены профиля?**

Пока не было обращений, что скрипты друг с другом как-то конфликтуют, но я бы всё равно не советовал ставить их вместе. Теги [AVA], [SGN], [STA] и [NIC] также понимаются этим скриптом, маски со старых постов не слетят.

* **В скрипте всё страшно и непонятно, всё сплошным текстом, а вдруг там что плохое?**

Читаемый код скрипта для разбора доступен по ссылке: http://f.etrin.ru/hvss/hvss-latest.js и на github.
Минимизированная версия всего лишь подверглась обработке javascript-minifier для более быстрой загрузки и обработке Babel.js для работы в старых браузерах. Можно подключить на форум несжатую версию, ничего особенно не изменится.

* **Куда вставлять скрипты? Как вставлять скрипты? В каком порядке?**

Скрипт и его настройки вставляются в поля html-верх или html-низ в разделе «Администрирование > Настройки» вашего форума: сначала скрипт, потом его настройки.

* **У меня маска вставляет ЛЗ/аватар куда попало в профиле.**

Обратите внимание на настройку userFields, она должна в обязательном порядке содержать классы всех видимых полей профиля (а не только тех, которые меняются) в том порядке, в каком они есть.

* **После изменения прав доступа к форумам всё перестало работать.**

Внимательно проверьте, чтобы в названиях форумов и групп были правильно расставлены запятые, а одинарные кавычки в названиях были заменены на \' — это важно для работы скрипта.
Также проверьте, чтобы названия форумов совпадали вплоть до регистра - так, как они указаны в настройках вашего форума.

* **Я заметил ошибку!**

Автор скрипта доступен для фидбека по электронному адресу homoveneficus@gmail.com

## Расширенное описание настроек для продвинутых администраторов

| Настройка | Значение по умолчанию | Комментарий |
| :-------- | :-------------------- | :---------- |
|buttonImage| ![http://i.imgur.com/ONu0llO.png](http://i.imgur.com/ONu0llO.png) | Картинка bb-кнопки замены (вместо дефалтной можно ставить свою: просто замените ссылку на картинку) |
|defaultAvatar|![http://i.imgur.com/bQuC3S1.png](http://i.imgur.com/bQuC3S1.png)||
|forumAccess|разрешено для всех пользователей|Открывает группам пользователей частичный доступ к скрипту – дает менять только аватар. Если удалить это значение, то делать это смогут все игроки во всех форумах без ограничений.<br>Чтобы разрешить смену аватаров в отдельных форумах только некоторым группам, вводите их названия в виде ‘Название форума’: ['Название группы 1', 'Название группы 2'].<br>Чтобы запретить частичную маску везде, пропишите в названии форума несуществующее у вас название.<br>В полной маске аватару менять всё ещё будет можно.<br><b>ВАЖНО!</b> Если в названиях групп или форума есть апостроф, поставьте перед ним обратный слэш: '<br>Это важно для работы скрипта.|
|forumAccessExtended|запрещено для всех пользователей|Открывает группам пользователей доступ к использованию полной маски. Если удалить это значение, то никто, кроме администратора и модераторов, не сможет использовать весь функционал маски.<br>Чтобы открыть полный доступ к маске, вводите названия групп в виде ‘Название форума’: ['Название группы 1', 'Название группы 2'].<br><b>ВАЖНО!</b> Если в названиях групп или форума есть апостроф, поставьте перед ним обратный слэш: '<br>Это важно для работы скрипта.|
|guestAccess|запрещено для всех форумов|Подключает (оставьте true) и отключает (замените на false) превью при создании маски.|
|showPreview|true|Сюда нужно вводить в виде  ["Название форума 1", "Название форума 2"] названия форумов, в которых будут продолжать отображаться маски удаленных профилей.<br>Полезно для игровых архивов.<br>Гости пользоваться масками не могут.|
|changeList|-|Позволят добавлять собственные поля для заполнения маски. Например, поля личных званий.<br>Составляющие настройки с пояснением:<br><blocquote><pre>'info': { — название для работы скрипта: произвольное, пишется латиницей и слитно<br>      title: 'Личное звание', — или любое другое понятное игрокам название нового поля.<br>      description: 'Принимает HTML', — описание и пояснение к новому полю, которое даст понять при заполнении маски, что это за поле и как его заполнять.<br>      tag: 'info', — тег, который будет использоваться для вставки изменений, , вместо 'info' можно использовать любое латинское слово или сочетание символов без пробелов, кроме уже существующих bb-тегов.<br>      class: 'pa-fld1', — класс поля в профиле, который вы планируете заменить.<br>      defaultCode: '&lt;b>Имя Фамилия, возраст&lt;sup>y.o.&lt;/sup>&lt;/b>&lt;br>&lt;i>сфера деятельности&lt;/i>,' — факультативный пункт, необязательный для заполнения: шаблон личного звания, чтобы облегчить игрокам работу с масками. Вставляется по нажатию на кнопку.<br>      type: 'html' — параметр, который позволяет использовать html- и bb-теги. Можно вместо 'html' использовать 'text' – тогда скрипт не будет воспринимать теги и вставит их как текст.<br>}</pre></blockquote><br><b>ВАЖНО!</b> Если в если в любом из полей встречается апостроф, поставьте перед ним обратный слэш: '<br>Это важно для работы скрипта.|
|userFields|['pa-author', 'pa-title', 'pa-avatar', 'pa-fld1','pa-reg','pa-posts','pa-respect', 'pa-positive', 'pa-awards', 'pa-gifts']||